metadata:
  id: "deploy-duckdns"
  name: "DuckDNS"
  description: "DuckDNS is a free service which will point a DNS (sub domains of duckdns.org) to an IP of your choice. The service is completely free, and doesn't require reactivation or forum posts to maintain its existence. Uses duckdns image from linuxserver.io"
  author: "Nixopus Team"
  icon: "ðŸ¦†"
  category: "Network"
  type: "install"
  version: "1.0.0"
  isVerified: false

variables:
  image:
    type: "string"
    description: "Docker image for DuckDNS"
    default: "lscr.io/linuxserver/duckdns"
    is_required: true

  tag:
    type: "string"
    description: "Docker image tag"
    default: "latest"
    is_required: true

  container_name:
    type: "string"
    description: "Name of the DuckDNS container"
    default: "duckdns"
    is_required: true

  config_volume_name:
    type: "string"
    description: "Named Docker volume for DuckDNS persistent configuration files (required if LOG_FILE=true)"
    default: "duckdns-config"
    is_required: false

  puid:
    type: "integer"
    description: "User ID for running the container (only needed if mounting /config)"
    default: 1000
    is_required: false

  pgid:
    type: "integer"
    description: "Group ID for running the container (only needed if mounting /config)"
    default: 1000
    is_required: false

  timezone:
    type: "string"
    description: "Timezone (TZ) environment variable"
    default: "Etc/UTC"
    is_required: false

  subdomains:
    type: "string"
    description: "DuckDNS subdomains (comma-separated, no spaces). If your domain is user.duckdns.org, use 'user' not 'user.duckdns.org'"
    default: ""
    is_required: true

  token:
    type: "string"
    description: "DuckDNS token (required)"
    default: ""
    is_required: true

  update_ip:
    type: "string"
    description: "Set to ipv4, ipv6, or both to update only your public IPv4/6 address. Omitting uses DuckDNS for detection (IPv4 only). Note: both and ipv6 modes require host networking"
    default: ""
    is_required: false

  log_file:
    type: "string"
    description: "Set to true to log to file (requires /config volume)"
    default: "false"
    is_required: false

execution:
  run:
    - name: "Remove existing DuckDNS container if present"
      type: "docker"
      properties:
        action: "rm"
        name: "{{ container_name }}"
      timeout: 30

    - name: "Pull DuckDNS image"
      type: "docker"
      properties:
        action: "pull"
        image: "{{ image }}"
        tag: "{{ tag }}"
      timeout: 300

    - name: "Run DuckDNS container"
      type: "docker"
      properties:
        action: "run"
        name: "{{ container_name }}"
        image: "{{ image }}"
        tag: "{{ tag }}"
        volumes:
          - "{{ config_volume_name }}:/config"
        env:
          PUID: "{{ puid }}"
          PGID: "{{ pgid }}"
          TZ: "{{ timezone }}"
          SUBDOMAINS: "{{ subdomains }}"
          TOKEN: "{{ token }}"
          UPDATE_IP: "{{ update_ip }}"
          LOG_FILE: "{{ log_file }}"
        restart: "unless-stopped"
      timeout: 120

