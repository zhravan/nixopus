metadata:
  id: "deploy-foldingathome"
  name: "Folding@home"
  description: "Folding@home is a distributed computing project for simulating protein dynamics, including the process of protein folding and the movements of proteins implicated in a variety of diseases. It brings together citizen scientists who volunteer to run simulations of protein dynamics on their personal computers. Uses foldingathome image from linuxserver.io. Register for an account on https://app.foldingathome.org and retrieve the account token before first start."
  author: "Nixopus Team"
  icon: "ðŸ§¬"
  category: "Containers"
  type: "install"
  version: "1.0.0"
  isVerified: false

variables:
  image:
    type: "string"
    description: "Docker image for Folding@home"
    default: "lscr.io/linuxserver/foldingathome"
    is_required: true

  tag:
    type: "string"
    description: "Docker image tag"
    default: "latest"
    is_required: true

  container_name:
    type: "string"
    description: "Name of the Folding@home container"
    default: "foldingathome"
    is_required: true

  config_volume_name:
    type: "string"
    description: "Named Docker volume for Folding@home database and configuration"
    default: "foldingathome-config"
    is_required: true

  web_gui_host_port:
    type: "integer"
    description: "Host port for Folding@home web GUI (redirects to https://app.foldingathome.org, optional)"
    default: 7396
    is_required: false

  web_gui_container_port:
    type: "integer"
    description: "Container port for Folding@home web GUI"
    default: 7396
    is_required: false

  puid:
    type: "integer"
    description: "User ID for running the container"
    default: 1000
    is_required: false

  pgid:
    type: "integer"
    description: "Group ID for running the container"
    default: 1000
    is_required: false

  timezone:
    type: "string"
    description: "Timezone (TZ) environment variable"
    default: "Etc/UTC"
    is_required: false

  account_token:
    type: "string"
    description: "Account token from https://app.foldingathome.org account settings (required on first start, can be removed after configuration)"
    default: ""
    is_required: false

  machine_name:
    type: "string"
    description: "Friendly name for this Folding@home instance (no spaces, required on first start, can be removed after configuration)"
    default: ""
    is_required: false

  cli_args:
    type: "string"
    description: "Additional CLI arguments to pass to fah-client on container start (optional)"
    default: ""
    is_required: false

execution:
  run:
    - name: "Remove existing Folding@home container if present"
      type: "docker"
      properties:
        action: "rm"
        name: "{{ container_name }}"
      timeout: 30

    - name: "Pull Folding@home image"
      type: "docker"
      properties:
        action: "pull"
        image: "{{ image }}"
        tag: "{{ tag }}"
      timeout: 300

    - name: "Run Folding@home container"
      type: "docker"
      properties:
        action: "run"
        name: "{{ container_name }}"
        image: "{{ image }}"
        tag: "{{ tag }}"
        ports: "{{ web_gui_host_port }}:{{ web_gui_container_port }}"
        volumes:
          - "{{ config_volume_name }}:/config"
        env:
          PUID: "{{ puid }}"
          PGID: "{{ pgid }}"
          TZ: "{{ timezone }}"
          ACCOUNT_TOKEN: "{{ account_token }}"
          MACHINE_NAME: "{{ machine_name }}"
          CLI_ARGS: "{{ cli_args }}"
        restart: "unless-stopped"
      timeout: 180

