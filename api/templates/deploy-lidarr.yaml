metadata:
  id: "deploy-lidarr"
  name: "Lidarr"
  description: "Lidarr is a music collection manager for Usenet and BitTorrent users. It can monitor multiple RSS feeds for new tracks from your favorite artists and will grab, sort and rename them. Uses lidarr image from linuxserver.io"
  author: "Nixopus Team"
  icon: "ðŸŽµ"
  category: "Media"
  type: "install"
  version: "1.0.0"
  isVerified: false

variables:
  image:
    type: "string"
    description: "Docker image for Lidarr"
    default: "lscr.io/linuxserver/lidarr"
    is_required: true

  tag:
    type: "string"
    description: "Docker image tag (latest for stable releases, develop for develop branch, nightly for nightly branch)"
    default: "latest"
    is_required: true

  container_name:
    type: "string"
    description: "Name of the Lidarr container"
    default: "lidarr"
    is_required: true

  host_port:
    type: "integer"
    description: "Host port for Lidarr Web UI"
    default: 8686
    is_required: true

  container_port:
    type: "integer"
    description: "Container port for Lidarr Web UI"
    default: 8686
    is_required: true

  config_volume_name:
    type: "string"
    description: "Named Docker volume for Lidarr configuration files"
    default: "lidarr-config"
    is_required: true

  music_volume_name:
    type: "string"
    description: "Named Docker volume for music files (optional, see docs for well-planned paths)"
    default: ""
    is_required: false

  downloads_volume_name:
    type: "string"
    description: "Named Docker volume for download folder (optional, see docs for well-planned paths)"
    default: ""
    is_required: false

  puid:
    type: "integer"
    description: "User ID for running the container"
    default: 1000
    is_required: false

  pgid:
    type: "integer"
    description: "Group ID for running the container"
    default: 1000
    is_required: false

  timezone:
    type: "string"
    description: "Timezone (TZ) environment variable"
    default: "Etc/UTC"
    is_required: false

  proxy_domain:
    type: "string"
    description: "Domain name for Lidarr web UI (optional, recommended for internet access)"
    default: ""
    is_required: false

execution:
  run:
    - name: "Remove existing Lidarr container if present"
      type: "docker"
      properties:
        action: "rm"
        name: "{{ container_name }}"
      timeout: 30

    - name: "Pull Lidarr image"
      type: "docker"
      properties:
        action: "pull"
        image: "{{ image }}"
        tag: "{{ tag }}"
      timeout: 300

    - name: "Run Lidarr container"
      type: "docker"
      properties:
        action: "run"
        name: "{{ container_name }}"
        image: "{{ image }}"
        tag: "{{ tag }}"
        ports: "{{ host_port }}:{{ container_port }}"
        volumes:
          - "{{ config_volume_name }}:/config"
          - "{{ music_volume_name }}:/music"
          - "{{ downloads_volume_name }}:/downloads"
        env:
          PUID: "{{ puid }}"
          PGID: "{{ pgid }}"
          TZ: "{{ timezone }}"
        restart: "unless-stopped"
      timeout: 180

    - name: "Add proxy for Lidarr web UI"
      type: "proxy"
      properties:
        action: "add"
        domain: "{{ proxy_domain }}"
        port: "{{ host_port }}"
      timeout: 30

