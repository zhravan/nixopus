metadata:
  id: "deploy-medusa"
  name: "Medusa"
  description: "Medusa is an automatic Video Library Manager for TV Shows. It watches for new episodes of your favorite shows, and when they are posted it does its magic. Uses medusa image from linuxserver.io"
  author: "Nixopus Team"
  icon: "ðŸ“º"
  category: "Media"
  type: "install"
  version: "1.0.0"
  isVerified: false

variables:
  image:
    type: "string"
    description: "Docker image for Medusa"
    default: "lscr.io/linuxserver/medusa"
    is_required: true

  tag:
    type: "string"
    description: "Docker image tag"
    default: "latest"
    is_required: true

  container_name:
    type: "string"
    description: "Name of the Medusa container"
    default: "medusa"
    is_required: true

  host_port:
    type: "integer"
    description: "Host port for Medusa web UI"
    default: 8081
    is_required: true

  container_port:
    type: "integer"
    description: "Container port for Medusa web UI"
    default: 8081
    is_required: true

  config_volume_name:
    type: "string"
    description: "Named Docker volume for Medusa persistent configuration files"
    default: "medusa-config"
    is_required: true

  downloads_volume_name:
    type: "string"
    description: "Named Docker volume for download location"
    default: "medusa-downloads"
    is_required: true

  tv_volume_name:
    type: "string"
    description: "Named Docker volume for TV shows location"
    default: "medusa-tv"
    is_required: true

  puid:
    type: "integer"
    description: "User ID for running the container"
    default: 1000
    is_required: false

  pgid:
    type: "integer"
    description: "Group ID for running the container"
    default: 1000
    is_required: false

  timezone:
    type: "string"
    description: "Timezone (TZ) environment variable"
    default: "Etc/UTC"
    is_required: false

  proxy_domain:
    type: "string"
    description: "Domain name for Medusa web UI (optional, recommended for internet access)"
    default: ""
    is_required: false

execution:
  run:
    - name: "Remove existing Medusa container if present"
      type: "docker"
      properties:
        action: "rm"
        name: "{{ container_name }}"
      timeout: 30

    - name: "Pull Medusa image"
      type: "docker"
      properties:
        action: "pull"
        image: "{{ image }}"
        tag: "{{ tag }}"
      timeout: 300

    - name: "Run Medusa container"
      type: "docker"
      properties:
        action: "run"
        name: "{{ container_name }}"
        image: "{{ image }}"
        tag: "{{ tag }}"
        ports: "{{ host_port }}:{{ container_port }}"
        volumes:
          - "{{ config_volume_name }}:/config"
          - "{{ downloads_volume_name }}:/downloads"
          - "{{ tv_volume_name }}:/tv"
        env:
          PUID: "{{ puid }}"
          PGID: "{{ pgid }}"
          TZ: "{{ timezone }}"
        restart: "unless-stopped"
      timeout: 180

    - name: "Add proxy for Medusa web UI"
      type: "proxy"
      properties:
        action: "add"
        domain: "{{ proxy_domain }}"
        port: "{{ host_port }}"
      timeout: 30

